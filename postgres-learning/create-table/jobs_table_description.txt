-- Create a table in the 'management' schema to store job positions
CREATE TABLE management.jobs (
    -- Primary Key: BIGINT for large range of IDs, auto-generated by PostgreSQL
    -- GENERATED ALWAYS AS IDENTITY ensures PostgreSQL controls ID generation (can't be manually inserted)
    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    
    -- Job title: VARCHAR(100) limits the title to 100 characters
    -- NOT NULL ensures every job must have a title
    job_title VARCHAR(100) NOT NULL,
    
    -- Salary range: NUMERIC(12, 2) allows up to 12 digits total with 2 decimal places
    -- Example: 9,999,999,999.99 (10 digits before decimal, 2 after)
    -- These are optional (nullable) since some jobs may not have defined salary ranges
    min_salary NUMERIC(12, 2),
    max_salary NUMERIC(12, 2),
    
    -- Auditing & Soft Delete Columns
    -- created_at: Automatically records when the row was inserted using CURRENT_TIMESTAMP
    -- TIMESTAMP WITH TIME ZONE stores the exact moment including timezone info
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- updated_at: Should be updated whenever the row is modified
    -- Defaults to creation time, needs a trigger to auto-update on changes
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    
    -- deleted_at: NULL means active record, a timestamp means "soft deleted"
    -- Allows us to mark records as deleted without actually removing them from the database
    deleted_at TIMESTAMP WITH TIME ZONE,
    
    -- Table constraint: Ensures max_salary is always >= min_salary
    -- Prevents illogical data like min: $100,000, max: $50,000
    CONSTRAINT check_salary_range CHECK (max_salary >= min_salary)
);

-- The "Smart" Unique Index for soft deletes
-- Creates a unique constraint on job_title, but ONLY for active (non-deleted) records
-- WHERE clause filters to only rows where deleted_at IS NULL
-- This allows the same job_title to exist multiple times if previous versions are soft-deleted
-- Example: "Manager" can be deleted and recreated without violating uniqueness
CREATE UNIQUE INDEX idx_unique_active_job_title 
ON management.jobs (job_title) 
WHERE deleted_at IS NULL;